# üìä M√©tadonn√©es Prisma DMMF - Documentation

Ce r√©pertoire contient les m√©tadonn√©es extraites du sch√©ma Prisma DMMF (Data Model Meta Format) pour la base de donn√©es **CENOV_DEV**.

## üöÄ G√©n√©ration des fichiers

Pour r√©g√©n√©rer tous les fichiers :

```bash
node scripts/Script\ DMMF/extract-dmmf-metadata.mjs
```

## üìÅ Fichiers g√©n√©r√©s (8 fichiers)

### 1. **quick-stats.json** (~63 lignes)

**Usage :** Aper√ßu rapide de la structure de la base de donn√©es

**Contenu :**

- Vue d'ensemble num√©rique (total mod√®les, champs, relations)
- R√©partition par sch√©ma (produit/public)
- Distribution des types de champs
- Types de relations
- Statistiques des contraintes

**Quand l'utiliser :** Pour un aper√ßu rapide sans d√©tails techniques

---

### 2. **summary-dmmf.json** (~98 lignes)

**Usage :** Statistiques essentielles de la base de donn√©es

**Contenu :**

- M√©tadonn√©es d'extraction
- Statistiques globales compl√®tes

**Quand l'utiliser :** Pour consulter les statistiques d√©taill√©es

---

### 3. **models-index.json** (~367 lignes)

**Usage :** Index de navigation des mod√®les

**Contenu :**

- Liste compl√®te des 22 mod√®les
- Sch√©ma, type (table/vue), nombre de champs
- Cl√© primaire (simple/composite)
- Niveau d'import (ordre topologique)
- D√©pendances (tables parentes)
- D√©pendants (tables enfants)
- Indicateur d'auto-r√©f√©rence

**Quand l'utiliser :**

- Pour naviguer dans les mod√®les
- Pour comprendre les d√©pendances
- Pour identifier les tables auto-r√©f√©rentielles

**Exemple :**

```json
{
	"kit": {
		"schema": "public",
		"type": "table",
		"fieldsCount": 7,
		"relationsCount": 3,
		"importLevel": 0,
		"dependencies": [],
		"dependents": ["kit_attribute", "part_nc", "product"]
	}
}
```

---

### 4. **relations-graph.json** (~496 lignes)

**Usage :** Graphe complet des relations et FK

**Contenu :**

- Toutes les 17 relations avec d√©tails complets
- Source et cible (mod√®le, sch√©ma, champ)
- Type de relation (N:1, 1:N, etc.)
- Cardinalit√© et obligation
- Champs FK et champs r√©f√©renc√©s
- Comportements onDelete/onUpdate
- Index par mod√®le (relations entrantes/sortantes)

**Quand l'utiliser :**

- Pour analyser les relations FK
- Pour visualiser le graphe de d√©pendances
- Pour comprendre les cascades de suppression

**Exemple :**

```json
{
	"id": "kit_attribute_to_kit",
	"sourceModel": "kit_attribute",
	"targetModel": "kit",
	"type": "N:1",
	"isRequired": true,
	"foreignKeyFields": ["kit_id"],
	"onDelete": "NoAction"
}
```

---

### 5. **import-order.json** (~105 lignes)

**Usage :** Planification de l'ordre d'import optimal

**Contenu :**

- Ordre lin√©aire d'import (tri topologique)
- 3 niveaux hi√©rarchiques (0, 1, 2)
- Indication de parall√©lisation possible
- Cas sp√©ciaux (auto-r√©f√©rences)
- Strat√©gies d'import pour tables complexes
- Liste des vues (√† importer en dernier)

**Quand l'utiliser :**

- Pour planifier un import de donn√©es
- Pour √©viter les erreurs de FK
- Pour g√©rer les auto-r√©f√©rences (category, family)

**Exemple :**

```json
{
	"levels": [
		{
			"level": 0,
			"description": "Tables sans d√©pendances (racines)",
			"tables": ["kit", "supplier", "attribute", "category"],
			"canImportInParallel": true
		}
	],
	"specialCases": {
		"selfReferencing": [
			{
				"table": "category",
				"strategy": "Import parents first, then children"
			}
		]
	}
}
```

---

### 6. **validation-rules.json** (~3428 lignes)

**Usage :** R√®gles de validation pour l'import de donn√©es

**Contenu :**

- R√®gles de validation par mod√®le et par champ
- Cl√©s primaires et contraintes unique
- Types et propri√©t√©s (required, unique, auto-generated)
- Types natifs PostgreSQL
- Valeurs par d√©faut
- Contraintes de FK avec mod√®le cible
- Valeurs enum autoris√©es

**Quand l'utiliser :**

- Pour valider des donn√©es avant import
- Pour g√©n√©rer des formulaires de saisie
- Pour cr√©er des sch√©mas de validation (Zod, Yup)

**Exemple :**

```json
{
	"kit": {
		"fields": {
			"id": {
				"type": "Int",
				"required": true,
				"isPrimaryKey": true,
				"isAutoGenerated": true,
				"nativeType": ["Int", []]
			},
			"name": {
				"type": "String",
				"required": true,
				"unique": true,
				"nativeType": ["VarChar", [255]]
			}
		}
	}
}
```

---

### 7. **native-types.json** (~69 lignes)

**Usage :** Mapping Prisma ‚Üî PostgreSQL

**Contenu :**

- Correspondance types Prisma ‚Üí types PostgreSQL
- Cat√©gorisation (num√©rique, texte, date, bool√©en)
- Statistiques d'utilisation

**Quand l'utiliser :**

- Pour comprendre les types de donn√©es
- Pour migrations manuelles SQL
- Pour g√©n√©ration de DDL

**Exemple :**

```json
{
	"mapping": {
		"String + VarChar(255)": "VARCHAR(255)",
		"DateTime + Timestamp(6)": "TIMESTAMP(6) WITHOUT TIME ZONE",
		"Int": "INTEGER"
	},
	"byCategory": {
		"text": {
			"String + VarChar(255)": "VARCHAR(255)"
		}
	}
}
```

---

### 8. **full-dmmf.json** (~13580 lignes)

**Usage :** R√©f√©rence technique compl√®te

**Contenu :**

- DMMF complet brut de Prisma
- Toutes les m√©tadonn√©es d√©taill√©es
- Tous les mod√®les avec analyse compl√®te

**Quand l'utiliser :**

- Pour r√©f√©rence technique approfondie
- Pour d√©veloppement d'outils avanc√©s
- Quand les autres fichiers ne suffisent pas

---

## üìä Statistiques globales

### Base de donn√©es CENOV_DEV

- **22 mod√®les** (17 tables + 5 vues)
- **217 champs** au total
- **17 relations** FK
- **0 enums**

### Par sch√©ma

**Sch√©ma `produit` :**

- 10 mod√®les (8 tables + 2 vues)
- 113 champs
- 11 relations

**Sch√©ma `public` :**

- 12 mod√®les (9 tables + 3 vues)
- 104 champs
- 6 relations

### Types de champs

- Int: 60 champs
- String: 81 champs
- DateTime: 33 champs
- Boolean: 3 champs
- Float: 6 champs

### Contraintes

- **0** cl√©s primaires simples
- **4** cl√©s primaires composites
- **12** contraintes unique
- **17** foreign keys

### Relations

- **11** relations N:1 required
- **6** relations N:1 optional
- **2** tables auto-r√©f√©rentielles (category, family)

---

## üéØ Cas d'usage recommand√©s

### Pour un d√©veloppeur d√©couvrant le projet

1. Lire **quick-stats.json** pour vue d'ensemble
2. Consulter **models-index.json** pour naviguer
3. Explorer **relations-graph.json** pour comprendre les liens

### Pour un import de donn√©es

1. Consulter **import-order.json** pour l'ordre
2. Utiliser **validation-rules.json** pour valider
3. Se r√©f√©rer √† **native-types.json** pour les types

### Pour g√©n√©rer du code

1. Utiliser **models-index.json** comme source
2. S'appuyer sur **validation-rules.json** pour les sch√©mas
3. Consulter **full-dmmf.json** pour d√©tails avanc√©s

---

## ‚ö†Ô∏è Notes importantes

- **DMMF est une API interne Prisma** qui peut changer entre versions mineures
- Ces fichiers sont g√©n√©r√©s automatiquement - ne pas les modifier manuellement
- Pour mettre √† jour, relancer le script d'extraction
- Les vues doivent toujours √™tre import√©es **APR√àS** leurs tables sources
- Les tables auto-r√©f√©rentielles n√©cessitent une strat√©gie d'import sp√©ciale

---

## üîÑ Ordre d'import recommand√©

### Niveau 0 (racines - parall√©lisable)

`kit`, `supplier`, `attribute`, `category`, `document`

### Niveau 1 (d√©pendances niveau 0 - parall√©lisable)

`product`, `kit_attribute`, `part_nc`, `category_attribute`, `family`, `attribute_value`, `document_link`

### Niveau 2 (d√©pendances niveaux pr√©c√©dents - parall√©lisable)

`cross_ref`, `price_purchase`, `product_category`

### Vues (√† la fin)

**Produit:** `produit_v_produit_categorie_attribut`, `v_price_purchase`
**Public:** `public_v_produit_categorie_attribut`, `v_categorie`, `v_kit_caracteristique`

---

G√©n√©r√© le : 2025-10-08
Base de donn√©es : **cenov_dev**
Script : `scripts/Script DMMF/extract-dmmf-metadata.mjs`
